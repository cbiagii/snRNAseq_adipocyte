<!DOCTYPE html><html lang="en-us" >

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">

  

  
  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Carlos Biagi Jr">

  
  
  
    
  
  <meta name="description" content="In this section we will perform the cell type classification using metacell package:
## Loading R packages library(Seurat) library(future) library(metacell) library(ggpubr) library(DropletUtils) library(pheatmap) ## Convert an Seurat object to 10x format to input in metacell data &lt;- readRDS(&quot;/Users/biagi/PhD/Adipocyte/output/10x/10x_Processed.">

  
  <link rel="alternate" hreflang="en-us" href="https://cbiagii.github.io/snRNAseq_adipocyte/post/4_metacell_original/">

  


  
  
  
  <meta name="theme-color" content="#1EBA9D">
  

  
  
  
  <script src="/snRNAseq_adipocyte/js/mathjax-config.js"></script>
  

  
  
  
  
    
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin="anonymous" title="hl-light" disabled>
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark">
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    

  

  
  
  
    
      
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=B612+Mono:400,700%7CMerriweather:400,700%7CLato:400,700&display=swap">
    
  

  
  
  
  
  <link rel="stylesheet" href="/snRNAseq_adipocyte/css/academic.css">

  




  


  
  

  

  <link rel="manifest" href="/snRNAseq_adipocyte/index.webmanifest">
  <link rel="icon" type="image/png" href="/snRNAseq_adipocyte/images/icon_hub765cfc86e6f389528c73dbc99f89318_358991_32x32_fill_lanczos_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="/snRNAseq_adipocyte/images/icon_hub765cfc86e6f389528c73dbc99f89318_358991_192x192_fill_lanczos_center_2.png">

  <link rel="canonical" href="https://cbiagii.github.io/snRNAseq_adipocyte/post/4_metacell_original/">

  
  
  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="snRNA-seq Adipocyte">
  <meta property="og:url" content="https://cbiagii.github.io/snRNAseq_adipocyte/post/4_metacell_original/">
  <meta property="og:title" content="4 - Classifying cell types from original data using metacell | snRNA-seq Adipocyte">
  <meta property="og:description" content="In this section we will perform the cell type classification using metacell package:
## Loading R packages library(Seurat) library(future) library(metacell) library(ggpubr) library(DropletUtils) library(pheatmap) ## Convert an Seurat object to 10x format to input in metacell data &lt;- readRDS(&quot;/Users/biagi/PhD/Adipocyte/output/10x/10x_Processed."><meta property="og:image" content="https://cbiagii.github.io/snRNAseq_adipocyte/images/icon_hub765cfc86e6f389528c73dbc99f89318_358991_512x512_fill_lanczos_center_2.png">
  <meta property="twitter:image" content="https://cbiagii.github.io/snRNAseq_adipocyte/images/icon_hub765cfc86e6f389528c73dbc99f89318_358991_512x512_fill_lanczos_center_2.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2020-10-15T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2020-10-15T00:00:00&#43;00:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://cbiagii.github.io/snRNAseq_adipocyte/post/4_metacell_original/"
  },
  "headline": "4 - Classifying cell types from original data using metacell",
  
  "datePublished": "2020-10-15T00:00:00Z",
  "dateModified": "2020-10-15T00:00:00Z",
  
  "author": {
    "@type": "Person",
    "name": "Carlos Biagi Jr"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "snRNA-seq Adipocyte",
    "logo": {
      "@type": "ImageObject",
      "url": "https://cbiagii.github.io/snRNAseq_adipocyte/images/icon_hub765cfc86e6f389528c73dbc99f89318_358991_192x192_fill_lanczos_center_2.png"
    }
  },
  "description": "In this section we will perform the cell type classification using metacell package:\n## Loading R packages library(Seurat) library(future) library(metacell) library(ggpubr) library(DropletUtils) library(pheatmap) ## Convert an Seurat object to 10x format to input in metacell data \u0026lt;- readRDS(\u0026quot;/Users/biagi/PhD/Adipocyte/output/10x/10x_Processed."
}
</script>

  

  


  


  





  <title>4 - Classifying cell types from original data using metacell | snRNA-seq Adipocyte</title>

</head>
<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="dark">

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  









<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/snRNAseq_adipocyte/">snRNA-seq Adipocyte</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/snRNAseq_adipocyte/">snRNA-seq Adipocyte</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/snRNAseq_adipocyte/post/"><span>Code</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      <li class="nav-item dropdown theme-dropdown">
        <a href="#" class="nav-link js-theme-selector" data-toggle="dropdown" aria-haspopup="true">
          <i class="fas fa-palette" aria-hidden="true"></i>
        </a>
        <div class="dropdown-menu">
          <a href="#" class="dropdown-item js-set-theme-light">
            <span>Light</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-dark">
            <span>Dark</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-auto">
            <span>Automatic</span>
          </a>
        </div>
      </li>
      

      

    </ul>

  </div>
</nav>


  <article class="article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1>4 - Classifying cell types from original data using metacell</h1>

  

  
    


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    Oct 15, 2020
  </span>
  

  

  

  
  
  

  
  

</div>

    














  
</div>



  <div class="article-container">

    <div class="article-style">
      <p>In this section we will perform the cell type classification using <code>metacell</code> package:</p>
<pre><code>## Loading R packages
library(Seurat)
library(future)
library(metacell)
library(ggpubr)
library(DropletUtils)
library(pheatmap)

## Convert an Seurat object to 10x format to input in metacell
data &lt;- readRDS(&quot;/Users/biagi/PhD/Adipocyte/output/10x/10x_Processed.rds&quot;)
write10xCounts(x = data@assays$RNA@counts, path = &quot;/Users/biagi/PhD/Adipocyte/output/10x/metacell/data&quot;)


## Initializing a database
if(!dir.exists(&quot;/Users/biagi/PhD/Adipocyte/output/10x/metacell/db&quot;)) dir.create(&quot;/Users/biagi/PhD/Adipocyte/output/10x/metacell/db&quot;)
scdb_init(&quot;/Users/biagi/PhD/Adipocyte/output/10x/metacell/db&quot;, force_reinit = TRUE)

## Loading the data generated by the 10x conversion above
mcell_import_scmat_10x(&quot;test1&quot;, base_dir = &quot;/Users/biagi/PhD/Adipocyte/output/10x/metacell/data&quot;)
mat &lt;- scdb_mat(&quot;test1&quot;)

## Linking to a figure directory
if(!dir.exists(&quot;/Users/biagi/PhD/Adipocyte/output/10x/metacell/figs&quot;)) dir.create(&quot;/Users/biagi/PhD/Adipocyte/output/10x/metacell/figs&quot;)
scfigs_init(&quot;/Users/biagi/PhD/Adipocyte/output/10x/metacell/figs&quot;)

## Plotting the distribution of UMI count per cell
mcell_plot_umis_per_cell(&quot;test1&quot;)

## Cleaning the data using a list of mitochondrial genes that typically mark cells as being stressed or dying, as well as immunoglobulin genes that may represent strong clonal signatures in plasma cells
mat &lt;- scdb_mat(&quot;test1&quot;)
nms &lt;- c(rownames(mat@mat), rownames(mat@ignore_gmat))
ig_genes &lt;- c(grep(&quot;^Igj&quot;, nms, v = TRUE), 
             grep(&quot;^Igh&quot;,nms,v = TRUE),
             grep(&quot;^Igk&quot;, nms, v = TRUE), 
             grep(&quot;^Igl&quot;, nms, v = TRUE))
bad_genes &lt;- unique(c(grep(&quot;^mt-&quot;, nms, v = TRUE), grep(&quot;^mtmr&quot;, nms, v = TRUE), grep(&quot;^Mtnd&quot;, nms, v = TRUE),&quot;NEAT1&quot;,&quot;TMSB4X&quot;, &quot;TMSB10&quot;, ig_genes))
mcell_mat_ignore_genes(new_mat_id = &quot;test1&quot;, mat_id = &quot;test1&quot;, bad_genes, reverse = FALSE)

## Eliminating cells with less than 700 UMIs
mcell_mat_ignore_small_cells(&quot;test1&quot;, &quot;test1&quot;, 700)

## Computing statistics on the distributions of each gene in the data, which are going to be our main tool for selecting feature genes
mcell_add_gene_stat(gstat_id = &quot;test1&quot;, mat_id = &quot;test1&quot;, force = TRUE)

## We create a new object of type gset, to which all genes whose scaled variance (variance divided by mean) exceeds a given threshold are added:
mcell_gset_filter_varmean(gset_id = &quot;test_feats&quot;, gstat_id = &quot;test1&quot;, T_vm = 0.08, force_new = TRUE)
mcell_gset_filter_cov(gset_id = &quot;test_feats&quot;, gstat_id = &quot;test1&quot;, T_tot = 100, T_top3 = 2)

## Plotting all genes and our selected gene set given the mean and variance statistics
mcell_plot_gstats(gstat_id = &quot;test1&quot;, gset_id = &quot;test_feats&quot;)

## Creating a similarity graph, using a construction called balanced K-nn graph
mcell_add_cgraph_from_mat_bknn(mat_id = &quot;test1&quot;, 
                               gset_id = &quot;test_feats&quot;, 
                               graph_id = &quot;test_graph&quot;,
                               K = 150,
                               dsamp = FALSE)

## Use the cgraph to sample 1000 metacell partitions, each covering 75% of the cells and organizing them in dense subgraphs
mcell_coclust_from_graph_resamp(
  coc_id = &quot;test_coc500&quot;,  
  graph_id = &quot;test_graph&quot;,
  min_mc_size = 20, 
  p_resamp = 0.75, n_resamp = 1000)

## The co-clustering statistics are used to generate a new similarity graph, based on which accurate calling of the final set of metacells
mcell_mc_from_coclust_balanced(
  coc_id = &quot;test_coc500&quot;, 
  mat_id = &quot;test1&quot;,
  mc_id = &quot;test_mc&quot;, 
  K = 20, min_mc_size = 20, alpha = 2)

## Splitting metacells whose underlying similarity structure supports the existence of multiple sub-clusters, and removes outlier cells that strongly deviate from their metacell's expression profile
mcell_plot_outlier_heatmap(mc_id = &quot;test_mc&quot;, mat_id = &quot;test1&quot;, T_lfc = 3)
mcell_mc_split_filt(new_mc_id = &quot;test_mc_f&quot;, 
                    mc_id = &quot;test_mc&quot;, 
                    mat_id = &quot;test1&quot;,
                    T_lfc = 3, plot_mats = FALSE)

## The filtered metacell object test_mc_f can now be visualized. In order to do this effectively, we usually go through one or two iterations of selecting informative marker genes. The package can select markers for you automatically - by simply looking for genes that are strongly enriched in any of the metacells
mcell_gset_from_mc_markers(gset_id = &quot;test_markers&quot;, mc_id = &quot;test_mc_f&quot;)


## Running 1st Round with known markers
load(&quot;/Users/biagi/PhD/Adipocyte/output/10x/metacell/db/mc.test_mc_f.Rda&quot;)
lfp &lt;- log2(object@mc_fp)

marks_colors &lt;- NULL
marks_colors &lt;- rbind(marks_colors, c(&quot;Adipocyte&quot;, &quot;Adrb3&quot;, &quot;blue&quot;, 1, 2))
marks_colors &lt;- rbind(marks_colors, c(&quot;Endothelial&quot;, &quot;Pecam1&quot;, &quot;green&quot;, 1, 1))
marks_colors &lt;- rbind(marks_colors, c(&quot;Immune_1&quot;, &quot;Ptprc&quot;, &quot;#ff748c&quot;, 1, 0.5))
marks_colors &lt;- rbind(marks_colors, c(&quot;Immune_2&quot;, &quot;Cd19&quot;, &quot;#ff8fa3&quot;, 1, 0.5))
marks_colors &lt;- rbind(marks_colors, c(&quot;Progenitor_1&quot;, &quot;Cd34&quot;, &quot;#ffa500&quot;, 1, 2))
marks_colors &lt;- rbind(marks_colors, c(&quot;Progenitor_2&quot;, &quot;Pdgfra&quot;, &quot;#ffb732&quot;, 1, 2))
marks_colors &lt;- as.data.frame(marks_colors)
colnames(marks_colors) &lt;- c(&quot;group&quot;, &quot;gene&quot;, &quot;color&quot;, &quot;priority&quot;, &quot;T_fold&quot;)
marks_colors$priority &lt;- as.integer(marks_colors$priority)
marks_colors$T_fold &lt;- as.numeric(marks_colors$T_fold)

mc &lt;- scdb_mc(&quot;test_mc_f&quot;)
gene_folds &lt;- mc@mc_fp

load(&quot;/Users/biagi/PhD/Adipocyte/output/10x/metacell/db/gset.test_markers.Rda&quot;)
gset &lt;- object
good_marks &lt;- intersect(names(gset@gene_set), rownames(mc@mc_fp))
mc_ord &lt;- 1:ncol(mc@mc_fp)

mat &lt;- log2(gene_folds[good_marks, mc_ord])
mat &lt;- pmax(pmin(mat, 3), -3)

## Selecting best markers for adipocyte cells
mat_A &lt;- mat[, which(mc@colors == &quot;blue&quot;)]
mat_A &lt;- mat_A[rowSums(mat_A) &gt; quantile(rowSums(mat_A), 0.9), ]
rowMeans(mat_A[names(head(sort(rowSums(mat_A), decreasing = TRUE), 5)), ])

## Selecting best markers for endothelial cells
mat_E &lt;- mat[, which(mc@colors == &quot;green&quot;)]
mat_E &lt;- mat_E[rowSums(mat_E) &gt; quantile(rowSums(mat_E), 0.9), ]
rowMeans(mat_E[names(head(sort(rowSums(mat_E), decreasing = TRUE), 5)), ])

## Selecting best markers for immune cells
mat_I &lt;- mat[, which(mc@colors %in% c(&quot;#ff748c&quot;, &quot;#ff8fa3&quot;))]
mat_I &lt;- mat_I[rowSums(mat_I) &gt; quantile(rowSums(mat_I), 0.9), ]
rowMeans(mat_I[names(head(sort(rowSums(mat_I), decreasing = TRUE), 5)), ])

## Selecting best markers for progenitor cells
mat_P &lt;- mat[, which(mc@colors %in% c(&quot;#ffa500&quot;, &quot;#ffb732&quot;))]
mat_P &lt;- mat_P[rowSums(mat_P) &gt; quantile(rowSums(mat_P), 0.9), ]
rowMeans(mat_P[names(head(sort(rowSums(mat_P), decreasing = TRUE), 5)), ])

## Plotting heatmat to check the found markers
items &lt;- list(Adipocytes = mat_A, Endothelials = mat_E, Immunes = mat_I, Progenitors = mat_P)
plot_list &lt;- list()
for (i in 1:length(items)){
  x &lt;- pheatmap(items[[i]], fontsize = 6, main = names(items)[i], legend = FALSE, treeheight_row = 0, treeheight_col = 0)
  plot_list[[i]] &lt;- x[[4]]
}
gggpubr(plotlist = plot_list, ncol = 2)


## Running 2nd round with unsupervised markers provided by metacell
marks_colors &lt;- NULL
marks_colors &lt;- rbind(marks_colors, c(&quot;Adipocyte_1&quot;, &quot;Acsl1&quot;, &quot;#0000b3&quot;, 1, 2.5))
marks_colors &lt;- rbind(marks_colors, c(&quot;Adipocyte_2&quot;, &quot;Plin4&quot;, &quot;#0000cc&quot;, 1, 2.5))
marks_colors &lt;- rbind(marks_colors, c(&quot;Adipocyte_3&quot;, &quot;Mlxipl&quot;, &quot;#0000e6&quot;, 1, 2.5))
marks_colors &lt;- rbind(marks_colors, c(&quot;Adipocyte_4&quot;, &quot;Pck1&quot;, &quot;#0000ff&quot;, 1, 2.5))
marks_colors &lt;- rbind(marks_colors, c(&quot;Adipocyte_5&quot;, &quot;Adrb3&quot;, &quot;#1a1aff&quot;, 1, 2.5))
marks_colors &lt;- rbind(marks_colors, c(&quot;Endothelial_1&quot;, &quot;Btnl9&quot;, &quot;#00cd00&quot;, 1, 1))
marks_colors &lt;- rbind(marks_colors, c(&quot;Endothelial_2&quot;, &quot;Flt1&quot;, &quot;#00b300&quot;, 1, 1))
marks_colors &lt;- rbind(marks_colors, c(&quot;Endothelial_3&quot;, &quot;Kdr&quot;, &quot;#009a00&quot;, 1, 1))
marks_colors &lt;- rbind(marks_colors, c(&quot;Endothelial_4&quot;, &quot;Cdh13&quot;, &quot;#008000&quot;, 1, 1))
marks_colors &lt;- rbind(marks_colors, c(&quot;Endothelial_5&quot;, &quot;Cyyr1&quot;, &quot;#006700&quot;, 1, 1))
marks_colors &lt;- rbind(marks_colors, c(&quot;Immune_1&quot;, &quot;Zeb2&quot;, &quot;#ff7f7f&quot;, 1, 0.85))
marks_colors &lt;- rbind(marks_colors, c(&quot;Immune_2&quot;, &quot;Trps1&quot;, &quot;#ff6666&quot;, 1, 0.85))
marks_colors &lt;- rbind(marks_colors, c(&quot;Immune_3&quot;, &quot;Runx1&quot;, &quot;#ff4c4c&quot;, 1, 0.85))
marks_colors &lt;- rbind(marks_colors, c(&quot;Immune_4&quot;, &quot;Ptprc&quot;, &quot;#ff3232&quot;, 1, 0.85))
marks_colors &lt;- rbind(marks_colors, c(&quot;Immune_5&quot;, &quot;Adap2&quot;, &quot;#ff1919&quot;, 1, 0.85))
marks_colors &lt;- rbind(marks_colors, c(&quot;Progenitor_1&quot;, &quot;Dcn&quot;, &quot;#ffff4d&quot;, 1, 2.5))
marks_colors &lt;- rbind(marks_colors, c(&quot;Progenitor_2&quot;, &quot;Celf2&quot;, &quot;#ffff33&quot;, 1, 2.5))
marks_colors &lt;- rbind(marks_colors, c(&quot;Progenitor_3&quot;, &quot;Meg3&quot;, &quot;#ffff1a&quot;, 1, 2.5))
marks_colors &lt;- rbind(marks_colors, c(&quot;Progenitor_4&quot;, &quot;Col1a2&quot;, &quot;#ffff00&quot;, 1, 2.5))
marks_colors &lt;- rbind(marks_colors, c(&quot;Progenitor_5&quot;, &quot;Col3a1&quot;, &quot;#e6e600&quot;, 1, 2.5))
marks_colors &lt;- as.data.frame(marks_colors)
colnames(marks_colors) &lt;- c(&quot;group&quot;, &quot;gene&quot;, &quot;color&quot;, &quot;priority&quot;, &quot;T_fold&quot;)
marks_colors$priority &lt;- as.integer(marks_colors$priority)
marks_colors$T_fold &lt;- as.numeric(marks_colors$T_fold)

mc_colorize(&quot;test_mc_f&quot;, marker_colors=marks_colors)
mc &lt;- scdb_mc(&quot;test_mc_f&quot;)

## We can use the colors to produce a labeled heat map, showing selected genes and their distributions over metacells, with the colored annotation shown at the bottom
mcell_mc_plot_marks(mc_id = &quot;test_mc_f&quot;, gset_id = &quot;test_markers&quot;, mat_id = &quot;test1&quot;, plot_cells = FALSE)

lfp &lt;- log2(mc@mc_fp)

## Projecting metacells and cells in 2D
mcell_mc2d_force_knn(mc2d_id = &quot;test_2dproj&quot;,mc_id = &quot;test_mc_f&quot;, graph_id = &quot;test_graph&quot;)
tgconfig::set_param(&quot;mcell_mc2d_height&quot;, 1000, &quot;metacell&quot;)
tgconfig::set_param(&quot;mcell_mc2d_width&quot;, 1000, &quot;metacell&quot;)
mcell_mc2d_plot(mc2d_id=&quot;test_2dproj&quot;)
</code></pre>

    </div>

    






















  
  





  </div>
</article>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.min.js" integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin="anonymous"></script>

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.4.8/mermaid.min.js" integrity="sha256-lyWCDMnMeZiXRi7Zl54sZGKYmgQs4izcT7+tKc+KUBk=" crossorigin="anonymous" title="mermaid"></script>
      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    <script>const isSiteThemeDark = true;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/snRNAseq_adipocyte/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks",
        'slides' : "Slides"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/snRNAseq_adipocyte/js/academic.min.66c553246b0f279a03be6e5597f72b52.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    
  </p>

  
  






  <p class="powered-by">
    
    Published with
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic Website Builder</a>
    

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
